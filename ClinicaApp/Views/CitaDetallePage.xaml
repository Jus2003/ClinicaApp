<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ClinicaApp.Views.CitaDetallePage"
             Title="Detalle de Cita">

    <Grid>
        <!-- Loading Overlay -->
        <Grid IsVisible="{Binding IsLoading}" 
              BackgroundColor="#80000000" 
              ZIndex="999">
            <StackLayout VerticalOptions="Center" 
                        HorizontalOptions="Center">
                <ActivityIndicator IsRunning="True" 
                                 Color="White" 
                                 Scale="1.5"/>
                <Label Text="Cargando..." 
                       TextColor="White" 
                       FontSize="16" 
                       HorizontalTextAlignment="Center"/>
            </StackLayout>
        </Grid>

        <!-- Main Content -->
        <ScrollView>
            <StackLayout Padding="20" Spacing="20">

                <!-- Error Message -->
                <Frame IsVisible="{Binding Message, Converter={StaticResource StringToBoolConverter}}" 
                       BackgroundColor="#FFEBEE" 
                       BorderColor="#F44336" 
                       CornerRadius="8" 
                       Padding="15">
                    <Label Text="{Binding Message}" 
                           TextColor="#C62828" 
                           FontSize="14" 
                           HorizontalTextAlignment="Center"/>
                </Frame>

                <!-- Cita Info -->
                <Frame IsVisible="{Binding Cita, Converter={StaticResource IsNotNullConverter}}" 
                       BackgroundColor="White" 
                       HasShadow="True" 
                       CornerRadius="12" 
                       Padding="0">

                    <StackLayout>
                        <!-- Header -->
                        <Grid BackgroundColor="#E3F2FD" 
                              Padding="20,15">
                            <StackLayout>
                                <Label Text="{Binding Cita.NombreEspecialidad}" 
                                       FontSize="20" 
                                       FontAttributes="Bold" 
                                       TextColor="#1565C0" 
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Cita.FechaFormateada}" 
                                       FontSize="16" 
                                       TextColor="#1976D2" 
                                       HorizontalTextAlignment="Center" 
                                       Margin="0,5,0,0"/>
                                <Label Text="{Binding Cita.HoraFormateada}" 
                                       FontSize="16" 
                                       FontAttributes="Bold" 
                                       TextColor="#1976D2" 
                                       HorizontalTextAlignment="Center"/>
                            </StackLayout>
                        </Grid>

                        <!-- Content -->
                        <StackLayout Padding="20" Spacing="15">

                            <!-- MÃ©dico -->
                            <StackLayout>
                                <Label Text="ðŸ‘¨â€âš•ï¸ MÃ©dico" 
                                       FontSize="14" 
                                       FontAttributes="Bold" 
                                       TextColor="#666"/>
                                <Label Text="{Binding Cita.NombreMedico}" 
                                       FontSize="16" 
                                       TextColor="#333" 
                                       Margin="0,5,0,0"/>
                            </StackLayout>

                            <!-- Paciente -->
                            <StackLayout>
                                <Label Text="ðŸ‘¤ Paciente" 
                                       FontSize="14" 
                                       FontAttributes="Bold" 
                                       TextColor="#666"/>
                                <Label Text="{Binding Cita.NombrePaciente}" 
                                       FontSize="16" 
                                       TextColor="#333" 
                                       Margin="0,5,0,0"/>
                            </StackLayout>

                            <!-- Tipo de Cita -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackLayout Grid.Column="0">
                                    <Label Text="ðŸ“‹ Tipo" 
                                           FontSize="14" 
                                           FontAttributes="Bold" 
                                           TextColor="#666"/>
                                    <Label Text="{Binding Cita.TipoCita}" 
                                           FontSize="16" 
                                           TextColor="#333" 
                                           Margin="0,5,0,0"/>
                                </StackLayout>

                                <StackLayout Grid.Column="1">
                                    <Label Text="ðŸ·ï¸ Estado" 
                                           FontSize="14" 
                                           FontAttributes="Bold" 
                                           TextColor="#666"/>
                                    <Label Text="{Binding Cita.EstadoCita}" 
                                           FontSize="16" 
                                           TextColor="#333" 
                                           Margin="0,5,0,0"/>
                                </StackLayout>
                            </Grid>

                            <!-- Sucursal -->
                            <StackLayout>
                                <Label Text="ðŸ¥ Sucursal" 
                                       FontSize="14" 
                                       FontAttributes="Bold" 
                                       TextColor="#666"/>
                                <Label Text="{Binding Cita.NombreSucursal}" 
                                       FontSize="16" 
                                       TextColor="#333" 
                                       Margin="0,5,0,0"/>
                                <Label Text="{Binding Cita.DireccionSucursal}" 
                                       FontSize="12" 
                                       TextColor="#777" 
                                       Margin="0,2,0,0"/>
                            </StackLayout>

                            <!-- Motivo -->
                            <StackLayout>
                                <Label Text="ðŸ“ Motivo de Consulta" 
                                       FontSize="14" 
                                       FontAttributes="Bold" 
                                       TextColor="#666"/>
                                <Label Text="{Binding Cita.MotivoConsulta}" 
                                       FontSize="16" 
                                       TextColor="#333" 
                                       Margin="0,5,0,0"/>
                            </StackLayout>

                            <!-- Observaciones -->
                            <StackLayout IsVisible="{Binding Cita.Observaciones, Converter={StaticResource StringToBoolConverter}}">
                                <Label Text="ðŸ’¬ Observaciones" 
                                       FontSize="14" 
                                       FontAttributes="Bold" 
                                       TextColor="#666"/>
                                <Label Text="{Binding Cita.Observaciones}" 
                                       FontSize="16" 
                                       TextColor="#333" 
                                       Margin="0,5,0,0"/>
                            </StackLayout>
                        </StackLayout>
                    </StackLayout>
                </Frame>

                <!-- Triaje Status -->
                <Frame IsVisible="{Binding EstadoTriaje, Converter={StaticResource IsNotNullConverter}}" 
                       BackgroundColor="White" 
                       HasShadow="True" 
                       CornerRadius="12" 
                       Padding="20">

                    <StackLayout Spacing="15">
                        <Label Text="ðŸ“‹ Estado del Triaje" 
                               FontSize="18" 
                               FontAttributes="Bold" 
                               TextColor="#2E7D32" 
                               HorizontalTextAlignment="Center"/>

                        <Grid IsVisible="{Binding EstadoTriaje.TriajeRealizado}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackLayout Grid.Column="0">
                                <Label Text="âœ… Respondidas" 
                                       FontSize="12" 
                                       TextColor="#666" 
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding EstadoTriaje.Estadisticas.TotalPreguntasRespondidas}" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="#4CAF50" 
                                       HorizontalTextAlignment="Center"/>
                            </StackLayout>

                            <StackLayout Grid.Column="1">
                                <Label Text="âš ï¸ Obligatorias" 
                                       FontSize="12" 
                                       TextColor="#666" 
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding EstadoTriaje.Estadisticas.ObligatoriasRespondidas}" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="#FF9800" 
                                       HorizontalTextAlignment="Center"/>
                            </StackLayout>
                        </Grid>

                        <Label IsVisible="{Binding EstadoTriaje.TriajeCompleto}" 
                               Text="âœ… Triaje Completado" 
                               FontSize="16" 
                               FontAttributes="Bold" 
                               TextColor="#4CAF50" 
                               HorizontalTextAlignment="Center"/>

                        <Label IsVisible="{Binding EstadoTriaje.TriajeRealizado, Converter={StaticResource InvertedBoolConverter}}" 
                               Text="â³ Triaje Pendiente" 
                               FontSize="16" 
                               FontAttributes="Bold" 
                               TextColor="#FF9800" 
                               HorizontalTextAlignment="Center"/>
                    </StackLayout>
                </Frame>

                <!-- Action Button -->
                <Button IsVisible="{Binding ShowTriajeButton}" 
                        Text="{Binding TriajeButtonText}" 
                        Command="{Binding CompletarTriajeCommand}" 
                        BackgroundColor="#2E7D32" 
                        TextColor="White" 
                        FontSize="16" 
                        FontAttributes="Bold" 
                        CornerRadius="12" 
                        Padding="0,15"/>

                <!-- Back Button -->
                <Button Text="â† Volver" 
                        Command="{Binding BackCommand}" 
                        BackgroundColor="#757575" 
                        TextColor="White" 
                        CornerRadius="8" 
                        Padding="0,12"/>

            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>